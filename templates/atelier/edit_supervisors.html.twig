{% extends 'base.html.twig' %}

{% block top %}
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <section class="hero-wrap js-fullheight" style="background-image: url({{ asset('images/bg_3.jpg') }});">
        <div class="overlay"></div>
        <div class="container-fluid px-0">
            <div class="row no-gutters text align-items-end js-fullheight justify-content-center"
                 data-scrollax-parent="true">
                <div class="col-md-12 ftco-animate text-center">
                    <p class="breadcrumbs"><span class="mr-2"><a
                                    href="{{ path('panel_atelier') }}">Panel ateliers</a></span></p>
                    <h1 class="bread">Gestion des superviseurs</h1>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block title %}Gestion des superviseurs{% endblock %}

{% block stylesheets %}
    <link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>
    <link href='{{ asset('css/draggable.css') }}' rel='stylesheet'>
{% endblock %}
{% block site %}
    <div>
        <div class="d-flex justify-content-around flex-wrap my-2" id="content">
            <div class="col m-2" id="supervisorsListWrap">
                <h3>Intervenants disponibles</h3>
                <div id="supervisorsList" class="py-3 d-flex justify-content-start align-items-start flex-wrap">
                    {% for sup in supervisors %}
                        {% if sup not in atelier.supervisors %}
                            <div supervisorId="{{ sup.id }}" class="col-sm-11 col-md-6 col-lg-3 card drag pt-1" style="height: fit-content; width: 18rem;">
                                <img style="width: 100px; height: 100px" src="{{ asset(sup.pictureFile) }}"
                                     class="card-img-top m-auto" alt="{{ sup.name }}">
                                <div class="card-body text-center">
                                    <p class="card-text">{{ sup.name }}</p>
                                </div>
                                <div class="mobileBtns text-center m-2">
                                    <button class="btn btn-success">Ajouter</button>
                                    <button class="btn btn-danger">Enlever</button>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            <div class="col m-2" id="supervisorsInWrap">
                <h3>Intervenants de l'atelier</h3>
                <div id="supervisorsIn" class="py-3 d-flex justify-content-start align-items-start flex-wrap">
                    {% for sup in supervisors %}
                        {% if sup in atelier.supervisors %}
                            <div supervisorId="{{ sup.id }}" class="col-sm-11 col-md-6 col-lg-3 card drag pt-1" style="height: fit-content; width: 18rem;">
                                <img style="width: 100px; height: 100px" src="{{ asset(sup.pictureFile) }}"
                                     class="card-img-top m-auto" alt="{{ sup.name }}">
                                <div class="card-body text-center">
                                    <p class="card-text">{{ sup.name }}</p>
                                </div>
                                <div class="mobileBtns text-center m-2">
                                    <button class="btn btn-success">Ajouter</button>
                                    <button class="btn btn-danger">Enlever</button>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="w-100 text-center my-3">
            <a href="{{ path('panel_atelier') }}" class="btn btn-primary mx-auto px-5">Retour</a>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"
            type="text/javascript"></script>
    <script>
        $('.drag').draggable({
            appendTo: 'body',
            helper: 'clone'
        });

        function add(o){
            $("#supervisorsIn").append(o);
            let donnees = {
                "supervisorId": $(o).attr("supervisorId")
            };
            let xhr = new XMLHttpRequest();
            xhr.open("PUT", "{{ path('api_supervisor_add', {'id':atelier.id}) }}")
            xhr.send(JSON.stringify(donnees))
        }

        function remove(o){
            $("#supervisorsList").append(o);
            let donnees = {
                "supervisorId": $(o).attr("supervisorId")
            };
            let xhr = new XMLHttpRequest();
            xhr.open("PUT", "{{ path('api_supervisor_remove', {'id':atelier.id}) }}")
            xhr.send(JSON.stringify(donnees))
        }

        $(".mobileBtns .btn-danger").click(function (event){
            remove($(event.target).parent().parent());
        });
        $(".mobileBtns .btn-success").click(function (event){
            add($(event.target).parent().parent());
        });

        $('#supervisorsInWrap').droppable({
            activeClass: 'active',
            hoverClass: 'hover',
            accept: ":not(.ui-sortable-helper)", // Reject clones generated by sortable
            drop: function (e, ui) {
                add(ui.draggable)
            }
        });
        $('#supervisorsListWrap').droppable({
            activeClass: 'active',
            hoverClass: 'hover',
            accept: ":not(.ui-sortable-helper)", // Reject clones generated by sortable
            drop: function (e, ui) {
                remove(ui.draggable)
            }
        });
        $("#supervisorsList")
    </script>
{% endblock %}